# TrapNinja SNMP Trap Forwarder Service
# Managed by Ansible - do not edit manually

[Unit]
Description=TrapNinja SNMP Trap Forwarder
After=network.target redis.service
Wants=redis.service

[Service]
Type=simple
User={{ trapninja_user }}
Group={{ trapninja_group }}
WorkingDirectory={{ trapninja_dest }}

# Main process - use optimization flag for best performance
ExecStart={{ trapninja_python }} -O {{ trapninja_dest }}/trapninja.py
ExecReload=/bin/kill -HUP $MAINPID

# Environment
Environment="TRAPNINJA_CONFIG={{ trapninja_config_dest }}"
Environment="PYTHONUNBUFFERED=1"

# Process management
Restart=always
RestartSec=5
TimeoutStopSec=30

# Security hardening
{% if trapninja_user != 'root' %}
AmbientCapabilities=CAP_NET_RAW CAP_NET_BIND_SERVICE
CapabilityBoundingSet=CAP_NET_RAW CAP_NET_BIND_SERVICE
{% endif %}
NoNewPrivileges=yes
ProtectSystem=strict
ProtectHome=yes
PrivateTmp=yes
ReadWritePaths={{ trapninja_config_dest }}
ReadWritePaths=/var/log/trapninja
ReadWritePaths=/run/trapninja

# Resource limits
LimitNOFILE=65536
LimitMEMLOCK=infinity

[Install]
WantedBy=multi-user.target
